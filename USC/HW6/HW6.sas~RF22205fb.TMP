* HW 6
Question A1;
libname mydata 'Z:\';
/* Define custom format for fund categories */
proc format;
    value fundCategory
        1 = 'Aggressive growth'
        2 = 'Long-term growth'
 		3 = 'Growth and income'
        4 = 'Income';
run;
* Read data from the specified file and apply formats and labels;
data investment_analysis;
    infile 'Z:\ex1719_281.dat' expandtabs;
	input fund$ cat load$ vol$ OPI;
	format cat fundCategory.;
    label OPI = 'Overall Performance Index';
	label cat = 'Fund Category';
run;
proc print data=investment_analysis;
run;
* Question A2;
proc sort data=investment_analysis;
	by cat;
run;
proc boxplot data=investment_analysis;
    plot OPI*cat;
    label OPI = 'Overall Performance Index'
          cat = 'Fund Category';
    title 'Boxplot of OPI by Fund Category';
run;
* Question A3;
proc means data=investment_analysis;
	class cat;
	var OPI;
	title 'Descriptive statistics of OPI for each fund category group';
run;
* Question A4;
proc glm data=investment_analysis;
	class cat;
	model OPI=cat/solution;
	means cat/tukey scheffe alpha=0.05;
	title 'ANOVA to obtain Tukey/Scheffe Tests';
run;
* Question B1;
proc format;
	value qrt 1='0-25%'
			 2='25-49%'
			 3='50-74%'
			 4='75-100%';
run;
data HW6_B1;
	set mydata.chol_281;
run;
proc means q1 median q3 data=HW6_B1;
	var BMI;
run;
data HW6_B1;
	set HW6_B1;
	if BMI ne . then do;
		if bmi<18.1634196 then BMIcat=1;
		else if bmi<21.4170933 then BMIcat=2;
		else if bmi<25.2794919 then BMIcat=3;
		else BMIcat=4;
	end;
	format BMIcat qrt.;
run;
proc freq data=HW6_B1;
	tables BMIcat;
run;
* Question B2;
data HW6_B2;
	set HW6_B1;
run;
proc sgplot data=HW6_B2;
	title 'Simple Linear Regression Log(Triglyerides) vs. Body Mass Index (kg/m2)';
	scatter y=logTg x=BMI;
	loess x=BMI y=logTg/clm;
	label logTg='Log(Triglycerides)';
	label bmi='BMI (kg/m2)';
run;
proc sort data=HW6_B2;
	by BMIcat;
run;
proc sgplot data=HW6_B2;
	title 'Log(Triglyerides) vs. Body Mass Index (Quartiles)';
	vbox logTg/category=BMIcat;
	label logTg='Log(Triglycerides)';
	label BMIcat='BMI Quartile';
run;
* Question B3;
proc glm data=HW6_B2;
	class BMIcat;
	model logtg=BMIcat/solution;
	means BMIcat/tukey alpha=0.05;
	title'ANOVA Log(Tg) association with BMIcat';
run;
* Question C1;
proc means q1 median q3 data=investment_analysis;
	title'Quartile 1, Median, and Quartile 3 OPI in each Fund Category';
	class cat;
	var OPI;
run;
proc npar1way data=investment_analysis wilcoxon;
	title'Kruskall Wallis Test for Differences in Median OPI among Fund Categories';
	class cat;
	var OPI;
run;
* Question C2;
proc rank data=investment_analysis out=rank;
	var opi;
	ranks rankopi;
run;
proc glm data=rank;
	title'Non-parametric ANOVA on Ranks assessing differences in OPI among Fund Categories';
	class cat;
	model rankopi=cat;
	means cat/tukey alpha=0.05;
run;
* Question D1;
data HW6_D;
	infile 'Z:\ex1219_281.dat' expandtabs;
	input House Y X1 X2 X3 X4 Z1 Z2;
	label Y='sales price in $1,000s' X1='area in hundreds of square feet' X2='number of bedrooms' X3='total number of rooms' X4='age in years';
	if Z1=Z2=0 then loc='In town';
	else if Z1=1 and Z2=0 then loc='Inner Suburbs';
	else if Z1=0 and Z2=1 then loc='Outer Suburbs';
run;
proc print data=HW6_D;
run;
proc freq data=HW6_D;
	table loc;
run;
proc glm data=HW6_D;
	title'ANOVA: Does selling price differ by location(in-town, inner suburbs, outer suburbs)?';
	class loc;
	model Y=loc/solution;
	means loc/scheffe alpha=0.05;
run;
*Question D2;
data df_temp;
	set HW6_D;
	temp_flag=1;
run;
proc means data=df_temp noprint;
	by temp_flag;
	var X1;
	output out=mean_results mean=mean_X1;
run;
data df_temp;
	merge mean_results df_temp;
	by temp_flag;
	centered_area=X1-mean_X1;
run;
proc corr data=df_temp;
	title'Is area associated with selling price?';
	var Y centered_area;
run;
proc glm data=df_temp;
	title'Is area associated with location?';
	class loc;
	model centered_area=loc/solution;
run;
* Question D3;
proc glm data=df_temp;
	title'ANCOVA: Mean selling price differs by location after centered area adjustment';
	class loc;
	model Y= centered_area loc/solution;
	lsmeans loc/tdiff adjust=Tukey;
run;
* Question D4;
proc sgplot data=df_temp;
	title'Scatter plots Selling Price vs. Centered Area by Location';
	scatter y=Y x=X1/group=loc;
	reg y=Y x=X1/group=loc;
run;
* Question D5;
proc glm data=df_temp;
	title'ANCOVA Price Differences by Centered Area by Location with Intereaction Terms'; 
	class loc;
	label y='Price' centered_area='Centered Area';
	model y= centered_area loc loc*centered_area/solution;
	lsmeans loc/tdiff adjust=tukey;
run;
* Question E2;
data HW6_E;
	infile 'Z:\ex1807_281.dat' expandtabs;
	input gene$ site y;
run;
proc print data=HW6_E;
run;
proc sgplot data=HW6_E;
	title'Scatterplot: Length vs. Genotype';
	scatter y=y x=gene;
	label y='Length(mm)' gene='Genotype';
run;
proc sgplot data=HW6_E;
	title'Scatterplot: Length vs. Lab Site';
	scatter y=y x=site;
	label y='Length(mm)' site='Laboratory Site';
run;
* Question E4;
proc anova data=HW6_E;
	title'ANOVA Treatment Effect';
	class gene site;
	model y=gene site;
	means gene/tukey alpha=0.05;
run;
* Question E5;
proc anova data=HW6_E;
	title 'ANOVA Length across Gene and Site';
	class gene site;
	model y=gene site;
run;
